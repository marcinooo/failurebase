"use strict";(self.webpackChunkfailurebase_client=self.webpackChunkfailurebase_client||[]).push([[953],{9406:function(e,t,n){n.r(t),n.d(t,{default:function(){return P}});var l=n(4942),i=n(1413),s=n(4925),r=n(9142),a=n(3433),c=n(9439),o=n(2791),d=n(7689),u=n(1087),m=n(4447),p=n(3223),h=n(7940),f=n(8390),g=n(1944),x=n(5687),v=n(8430),j=n(5265),Z=n(9489),b=n(9141),k=n(9672),S=n(4165),C=n(5861),y=n(5301),N=function(){var e=(0,C.Z)((0,S.Z)().mark((function e(t){return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,y.Z)("/api/events",t.toString());case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=(0,C.Z)((0,S.Z)().mark((function e(t){var n;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"POST",body:JSON.stringify({ids:t})},e.next=3,(0,y.Z)("/api/events/delete","",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_={getAll:N,deleteGiven:D},w=n(2278),A=n(8030),E=n(3934),F=n(184),M=[{id:"message-collumn",label:"Message",order:f.K.ASC},{id:"server-timestamp-collumn",label:"Server timestamp",order:f.K.DESC},{id:"client-timestamp-collumn",label:"Client timestamp",order:f.K.ASC},{id:"test-uid-collumn",label:"Test UID",order:f.K.ASC},{id:"test-marks-collumn",label:"Test marks",order:f.K.NULL}],P=function(){var e,t=(0,d.s0)(),n=(0,h.$)(),S=n.setLoading,C=n.selectedEvents,y=n.setSelectedEvents,N=(0,u.lr)(),D=(0,c.Z)(N,2),P=D[0],T=D[1],K=(0,o.useState)({}),O=(0,c.Z)(K,2),I=O[0],q=O[1],G=(0,o.useState)(0),L=(0,c.Z)(G,2),U=L[0],$=L[1],V=(0,o.useState)([]),B=(0,c.Z)(V,2),H=B[0],J=B[1],R=(0,o.useState)(0),z=(0,c.Z)(R,2),Q=z[0],W=z[1],X=(0,o.useState)(!1),Y=(0,c.Z)(X,2),ee=Y[0],te=Y[1],ne=(0,o.useState)(!1),le=(0,c.Z)(ne,2),ie=le[0],se=le[1],re=(0,o.useState)(0),ae=(0,c.Z)(re,2),ce=ae[0],oe=ae[1],de=(0,o.useState)(0),ue=(0,c.Z)(de,2),me=ue[0],pe=ue[1],he=(0,o.useState)(!1),fe=(0,c.Z)(he,2),ge=fe[0],xe=fe[1],ve=(0,o.useState)(""),je=(0,c.Z)(ve,2),Ze=je[0],be=je[1],ke=function(){S(!0),_.getAll(P).then((function(e){var t=e.items.map((function(e){return function(e){return{id:e.id.toString(),data:[{id:"message",label:(0,E.Dy)(e.message,100)},{id:"server-timestamp",label:e.server_timestamp},{id:"client-timestamp",label:e.client_timestamp},{id:"test-uid",label:(0,E.Dy)(e.test.uid,40)},{id:"test-marks",label:e.test.marks.join(", ")}]}}(e)})),n=document.querySelectorAll("#filter-modal input"),l={};n.forEach((function(e){var t,n=null!==(t=e.id.split("-").slice(1,-1).join("_"))&&void 0!==t?t:"",i=P.getAll(n);i.length>0&&(n.includes("timestamp")?l[n]=(0,E.d$)(new Date(i[0])):n.includes("mark")?l.marks=i:l[n]=i[0])}));var i=0!==C.length&&t.filter((function(e){return C.includes(e.id)})).length===t.length;J(t),W(e.page_number),se(e.prev_page),te(e.next_page),oe(e.count),pe(e.page_limit),xe(i),q(l),S(!1)})).catch((function(e){console.log(e),S(!1)}))};(0,o.useEffect)(ke,[window.location.href]),(0,o.useEffect)((function(){$(Object.keys(I).length)}),[I]);var Se=function(e){var t=e.target.id.split("-").slice(1,-1).join("_"),n=t.includes("timestamp")?(0,E.d$)(new Date(e.target.value)):e.target.value;if(""===e.target.value&&t in I){I[t];var a=(0,s.Z)(I,[t].map(r.Z));q(a)}else q((0,i.Z)((0,i.Z)({},I),{},(0,l.Z)({},t,n)))},Ce=function(e){if("marks"in I){var t=(0,i.Z)({},I);t.marks=I.marks.filter((function(t){var n;return t!==(null===(n=e.currentTarget.parentNode)||void 0===n?void 0:n.textContent)})),q(t)}};return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{className:"filters",children:[(0,F.jsx)("div",{className:"row",children:(0,F.jsxs)("div",{className:"col filter-button",children:[(0,F.jsx)("span",{className:"brand",children:"Events"}),(0,F.jsxs)(g.Z,{onClick:function(e){(0,v.h7)("filter-modal"),document.querySelectorAll("#filter-modal input").forEach((function(e){var t,n=null!==(t=P.get(e.id.split("-").slice(1,-1).join("_")))&&void 0!==t?t:"";""!==n&&(e.id.includes("timestamp")?e.value=(0,E.d$)(new Date(n)):e.id.includes("mark")?e.value="":e.value=n)}))},children:[(0,F.jsx)("img",{src:m.Z,alt:"Filter SVG"}),U>0&&(0,F.jsx)(x.Z,{text:U})]}),(0,F.jsx)(g.Z,{onClick:function(e){(0,v.h7)("delete-modal")},children:(0,F.jsx)("img",{src:p.Z,alt:"Delete SVG"})})]})}),(0,F.jsxs)(v.ZP,{id:"filter-modal",children:[(0,F.jsx)(j.Z,{children:(0,F.jsx)("span",{className:"text-primary",children:"Filter events"})}),(0,F.jsxs)(Z.Z,{children:[(0,F.jsxs)("p",{children:[(0,F.jsx)("label",{htmlFor:"filter-message-input",children:"Message"}),(0,F.jsx)("input",{id:"filter-message-input",type:"text",placeholder:"Type phrase to search",onChange:Se})]}),(0,F.jsxs)("p",{children:[(0,F.jsx)("label",{htmlFor:"filter-start-server-timestamp-input",children:"Start server timestamp"}),(0,F.jsx)("input",{id:"filter-start-server-timestamp-input",type:"datetime-local",onChange:Se})]}),(0,F.jsxs)("p",{children:[(0,F.jsx)("label",{htmlFor:"filter-end-server-timestamp-input",children:"End end timestamp"}),(0,F.jsx)("input",{id:"filter-end-server-timestamp-input",type:"datetime-local",onChange:Se})]}),(0,F.jsxs)("p",{children:[(0,F.jsx)("label",{htmlFor:"filter-start-client-timestamp-input",children:"Start client timestamp"}),(0,F.jsx)("input",{id:"filter-start-client-timestamp-input",type:"datetime-local",onChange:Se})]}),(0,F.jsxs)("p",{children:[(0,F.jsx)("label",{htmlFor:"filter-end-client-timestamp-input",children:"End client timestamp"}),(0,F.jsx)("input",{id:"filter-end-client-timestamp-input",type:"datetime-local",onChange:Se})]}),(0,F.jsxs)("p",{children:[(0,F.jsx)("label",{htmlFor:"filter-test-uid-input",children:"Test UID"}),(0,F.jsx)("input",{id:"filter-test-uid-input",type:"text",placeholder:"Type phrase to search",onChange:Se})]}),(0,F.jsxs)("p",{children:[(0,F.jsx)("label",{htmlFor:"filter-mark-input",children:"Mark"}),(0,F.jsxs)("span",{className:"grouped",children:[(0,F.jsx)("input",{id:"filter-test-mark-input",type:"text",placeholder:"Type mark to search"}),(0,F.jsx)("button",{id:"addMark",className:"button",onClick:function(e){var t=document.querySelector("#filter-test-mark-input");if(null!==t){var n,l=(0,i.Z)({},I);if(""!==t.value&&(void 0===l.marks||-1===l.marks.indexOf(t.value)))l.marks=[].concat((0,a.Z)(null!==(n=l.marks)&&void 0!==n?n:[]),[t.value]);t.value="",q(l)}},children:"Add"})]}),(0,F.jsx)("span",{children:null===I||void 0===I||null===(e=I.marks)||void 0===e?void 0:e.map((function(e,t){return(0,F.jsx)(A.Z,{text:e,onClose:Ce},t)}))})]})]}),(0,F.jsxs)(b.Z,{children:[(0,F.jsx)("button",{className:"button primary",onClick:function(e){for(var t=0,n=Object.entries(I);t<n.length;t++){var l=(0,c.Z)(n[t],2),i=l[0],s=l[1];if("marks"===i){P.delete("test_mark");for(var r=0;r<s.length;r++)P.append("test_mark",String(s[r]))}else P.set(i,String(s))}P.delete("page"),T(P),y([]),xe(!1),(0,v.Mr)("filter-modal")},children:"Submit"}),(0,F.jsx)("button",{className:"button",onClick:function(e){document.querySelectorAll("#filter-modal input").forEach((function(e){e.value="",P.delete(e.id.split("-").slice(1,-1).join("_"))})),q({}),T(P)},children:"Clear"}),(0,F.jsx)("button",{className:"button",onClick:function(e){(0,v.Mr)("filter-modal")},children:"Close"})]})]}),(0,F.jsxs)(v.ZP,{id:"delete-modal",children:[(0,F.jsx)(j.Z,{children:(0,F.jsx)("span",{className:"text-primary",children:"Delete events"})}),(0,F.jsxs)(Z.Z,{children:[0===C.length?(0,F.jsx)("strong",{children:"No event selected to deletion."}):1===C.length?(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("strong",{children:"1 event selected to deletion. "}),"Do you confirm deletion?"]}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("strong",{children:[C.length," events selected to deletion. "]}),"Do you confirm deletion?"]}),(0,F.jsxs)(k.ZP,{id:"deletion-in-progress",children:[(0,F.jsx)("div",{style:{marginBottom:"10px"},children:(0,F.jsx)("span",{children:"Deleting..."})}),(0,F.jsx)(w.Z,{})]}),(0,F.jsxs)(k.ZP,{id:"deletion-done",children:[(0,F.jsx)("span",{className:"text-primary",children:"Result:"}),(0,F.jsx)("br",{}),(0,F.jsx)("span",{dangerouslySetInnerHTML:{__html:Ze}})]})]}),(0,F.jsxs)(b.Z,{children:[(0,F.jsx)("button",{className:"button primary",onClick:function(e){0!==C.length&&((0,k.Kc)("deletion-in-progress"),_.deleteGiven(C).then((function(e){var t=[],n=[];e.statuses.forEach((function(e){200===e.status?t.push(String(e.id)):n.push(String(e.id))}));var l=0===n.length?"All events deleted successfully":"".concat(t.length," events deleted successfully, the rest no longer exist in database.");be(l),y([]),setTimeout((function(){(0,k.Ov)("deletion-in-progress"),(0,k.Kc)("deletion-done")}),1e3)})).catch((function(e){var t,n;be("Deletion error"),setTimeout((function(){(0,k.Ov)("deletion-in-progress"),(0,k.Kc)("deletion-done")}),1e3),console.log("Error details: ".concat(String(null!==(t=null===e||void 0===e||null===(n=e.response)||void 0===n?void 0:n.detail)&&void 0!==t?t:"no details ")))})))},children:"Confirm"}),(0,F.jsx)("button",{className:"button",onClick:function(e){be(""),(0,k.Ov)("deletion-done"),(0,v.Mr)("delete-modal"),console.log(C),""!==Ze&&ke()},children:"Close"})]})]}),(0,F.jsxs)(v.ZP,{id:"unselect-modal",children:[(0,F.jsx)(j.Z,{children:"Unselect items"}),(0,F.jsx)(Z.Z,{children:"Do you confirm unselection of all items?"}),(0,F.jsxs)(b.Z,{children:[(0,F.jsx)("button",{className:"button primary",onClick:function(e){xe(!1),y([]),(0,v.Mr)("unselect-modal")},children:"Confirm"}),(0,F.jsx)("button",{className:"button",onClick:function(e){(0,v.Mr)("unselect-modal")},children:"Close"})]})]})]}),(0,F.jsx)(f.Z,{header:M,data:H,selectedItemsInfo:0===C.length?"":1===C.length?"1 row selected":"".concat(C.length," rows selected"),pageInfo:"page ".concat(Q+1," of ").concat(0!==ce?Math.ceil(ce/me):1),secectedItems:C,selectAllChecked:ge,prevPageDisabled:!ie,nextPageDisabled:!ee,onSortClick:function(e,n){var l=e.replace("-collumn","").replaceAll("-","_"),i="".concat(n===f.K.DESC?"-":"").concat(l);P.set("ordering",i),T(P),t({pathname:"/events",search:"?"+String(P)})},onSelectAllChange:function(e){if(xe(!ge),ge){var t=H.map((function(e){return e.id})),n=C.filter((function(e){return!t.includes(e)}));y(n)}else{var l=H.filter((function(e){return!C.includes(e.id)})).map((function(e){return e.id})),i=[].concat((0,a.Z)(C),(0,a.Z)(l));y(i)}},onSelectOneChange:function(e){var t=e.target,n=t.id,l=t.checked?[].concat((0,a.Z)(C),[n]):C.filter((function(e){return e!==n})),i=H.filter((function(e){return l.includes(e.id)})).length===H.length;xe(i),y(l)},onNextPageClick:function(e){P.set("page",String(Q+1)),T(P)},onPrevPageClick:function(e){P.set("page",String(Q-1)),T(P)},onSelectedItemsClearClick:function(e){(0,v.h7)("unselect-modal")}})]})}}}]);
//# sourceMappingURL=953.cebfb6dc.chunk.js.map